<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <title>{{ title }}</title>
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">

        {% for file_ in handler.application.settings['css_files'] %}
            <link rel="stylesheet" href="{{ file_ }}">
        {% end %}

        {% for file_ in handler.application.settings['js_files'] %}                
            <script type="text/javascript" src="{{ file_ }}"></script>
        {% end %}

        <script type="text/javascript">
            for (var n in window.exports.default) {
                window[n] = window.exports.default[n];
            }
            seplis.apiClientSettings.baseUrl = "{{config['client']['public_api_url']}}";
            seplis.apiClientSettings.clientId = "{{config['client']['id']}}";

            function show_api_error(error) {
                var message = error.message + '.';
                if (error.code === 1001) {
                    for (var key in error.errors) {
                        message = message + _.template(
                            '<br><br><strong><%= field %><br></strong> <%= message %>.',
                            error.errors[key]
                        );
                    }
                }
                $('#errors').html(_.template(
                    '<div class="alert alert-danger alert-dismissible" role="alert">'+
                      '<button type="button" class="close" data-dismiss="alert">'+
                          '<span aria-hidden="true">&times;</span>'+
                          '<span class="sr-only">Close</span>'+
                      '</button>'+
                      '<%= message %>'+
                    '</div>',
                    {
                        'message':message,
                    }
                ));
            }
            $(function(){
                api = new Api();
                api.loaderGif = '/static/img/loader.gif';
                api.defaultErrorCallback = show_api_error;

                template = new Template();

                {% block jsready %}{% end %}
            });
        </script>
        {% block head %}{% end %}
    </head>
    <body>
        {% block menu %}
            {% module menu(menu_id=menu_id) %}
        {% end %}
        <div class="container">
            <noscript>
            <div class="alert alert-warning">
                <strong>WARNING:</strong> JavaScript seems to be disabled in your browser.<br>
                You won't be able to <strong>sign in</strong> or use the <strong>search form</strong> without enabling JavaScript.
            </div>
            </noscript>
            <div id="errors"></div>
            {% block body %}{% end %}
        </div>
        {% block body_outside %}{% end %}
        {% if config['debug'] %}
            <script src="{{config['client']['public_api_url'][:-5]}}:8080/webpack-dev-server.js"></script>
        {% end %}
    </body>
</html>