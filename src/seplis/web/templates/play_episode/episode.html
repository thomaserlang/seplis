{% extends ../base.html %}
{% block head %}
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
{% end %}
{% block menu %}{% end %}
{% block body_outside %}
    <style>
        body {
            background-color:#000;
        }
        .video-overlay {
            position:absolute;
            float:left;
            width:100%;
            z-index:300000;
        }
        .player-video-wrapper {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            opacity: 1;
            z-index: 1;
            visibility: visible;
        }
        .player-back {
            position: absolute;
            z-index: 2;
            left:10px;
            top:10px;
            display:block;
        }
        .player-controls-wrapper {
            position: absolute;
            bottom:10%;
            z-index: 2147483647;
            width:80%;
            left:10%;
        }
        .player-controls {
            background-color:#2E2E2E;
            color: #fff;
            height:50px;
            line-height:50px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;            
            display: -webkit-box;
            display: -moz-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
        }

        .player-control-button {
            cursor:pointer;
            padding-left:10px;
            padding-right:10px;
            border-right:1px solid #151515;            
            display: -webkit-box;
            display: -moz-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            overflow: visible;
        }

        .player-control-button i {
            font-size: 26px;
            height:50px;
            line-height:50px;
        }

        .player-control-button-right {            
            border-right:none;
            border-left:1px solid #151515;
        }

        .player-play-pause-button .player-play-pause-button {            
            -webkit-order:1;
            order:1;
        }
        .player-volume{            
            -webkit-order:2;
            order:2;
        }
        .player-control-title {
            margin-left:10px;
            float:left;
            font-size:16px;
            text-overflow: clip;
            overflow:hidden;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            -webkit-order:3;
            order:3;
        }
        .player-fullscreen-windowed-button{            
            -webkit-order:4;
            order:4;
        }

        .player-slider {            
            height:20px;
            background-color: #2E2E2E;
            margin-bottom:10px;
            cursor:pointer;
            display:relative;
            width:100%;
        }

        .player-slider-dot {
            position: relative;
            width:10px;
            height:30px;
            background-color:#428bca;
            top: -5.5px;
            border-left:solid 1px #2E2E2E;
        }

        .player-progress {
            position: relative;
            height:20px;
            background-color:#428bca;
            width:0;
        }

        .player-timeleft {
            position: relative;
            top:-45px;
            text-align: right;
            display: block;
            color:#fff;
        }

        .player-volume-slider {
            margin-left: 10px;
            display: inline !important;
            width: 60px !important;
        }

        video::-webkit-media-controls-enclosure {
          display:none !important;
        }
        video::-webkit-media-controls {
          display:none !important;
        }

        .player-loading{
            position: absolute;
            bottom:50%;
            z-index: 2147483647;
            width:100%;
            display:none;
        }
        .sk-spinner-wave.sk-spinner {
            margin: 0 auto;
            width: 100px;
            height: 70px;
            text-align: center;
            font-size: 10px; 
        }
        .sk-spinner-wave div {
            background-color: #428bca;
            height: 100%;
            width: 9px;
            display: inline-block;
            -webkit-animation: sk-waveStretchDelay 1.2s infinite ease-in-out;
                  animation: sk-waveStretchDelay 1.2s infinite ease-in-out; 
        }
        .sk-spinner-wave .sk-rect2 {
            -webkit-animation-delay: -1.1s;
            animation-delay: -1.1s; 
        }
        .sk-spinner-wave .sk-rect3 {
            -webkit-animation-delay: -1s;
            animation-delay: -1s; 
        }
        .sk-spinner-wave .sk-rect4 {
            -webkit-animation-delay: -0.9s;
            animation-delay: -0.9s; 
        }
        .sk-spinner-wave .sk-rect5 {
            -webkit-animation-delay: -0.8s;
            animation-delay: -0.8s; 
        }
        @-webkit-keyframes sk-waveStretchDelay {
            0%, 40%, 100% {
                -webkit-transform: scaleY(0.4);
                transform: scaleY(0.4); 
            }
            20% {
                -webkit-transform: scaleY(1);
                transform: scaleY(1); 
            } 
        }
        @keyframes sk-waveStretchDelay {
            0%, 40%, 100% {
                -webkit-transform: scaleY(0.4);
                transform: scaleY(0.4); 
            }
            20% {
                -webkit-transform: scaleY(1);
                transform: scaleY(1); 
            } 
        }

        .player-error{
            position: absolute;
            bottom:50%;
            z-index: 2147483646;
            width:100%;
            text-align: center;
            background-color:#000;
            padding:50px;
            color:#fff;
            font-size:24px;
            display: none;
        }
        .player-back{
            position: absolute;
            top:20px;
            left:20px;
            z-index: 2147483647;
            color:#fff;
            font-size:72px;
            cursor:pointer;
        }
    </style>
    <div class="player-video-wrapper">
        <div class="video" style="position: relative; width: 100%; height: 100%; overflow: hidden;">
            <video id="video" style="position: absolute; width: 100%; height: 100%;" preload="None">
            </video>
        </div>
        <div class="player-loading">
            <div class="sk-spinner sk-spinner-wave">
                <div class="sk-rect1"></div>
                <div class="sk-rect2"></div>
                <div class="sk-rect3"></div>
                <div class="sk-rect4"></div>
                <div class="sk-rect5"></div>
            </div>
        </div>
        <div class="player-error player-try-refresh">
            <font style="font-size:100px;color:#a94442;">&#x26a0;</font><br>
            An error occurred. <br>
            Try to "Refresh" or "Reload" this page.
        </div>
        <div class="player-error player-play-server-error">
            <font style="font-size:100px;color:#a94442;">&#x26a0;</font><br>
            None of your play servers are available.
        </div>
        <div class="player-error player-episode-404">
            <font style="font-size:100px;color:#1E90FF;">&#x26a0;</font><br>
            This episode does not exist on any of your play servers.
        </div>
        <div class="player-back">
            <i class="glyphicon glyphicon-circle-arrow-left" title="Go back"></i>
        </div>
        <div class="player-controls-wrapper">
            <div class="player-slider"> 
                <div class="player-progress">
                    <div class="player-slider-dot"></div>
                </div>  
                <label class="player-timeleft"></label>                      
            </div>
            <div class="player-controls">
                <div class="player-control-button player-play-pause-button player-play-button">
                    <i class="glyphicon glyphicon-play"></i>
                </div>
                <div class="player-control-button player-play-pause-button player-pause-button hidden">
                    <i class="glyphicon glyphicon-pause"></i>
                </div>
                <div class="player-control-button player-volume">
                    <i class="glyphicon glyphicon-volume-up"></i>
                    <input class="player-volume-slider" type="range" min="0" max="1" step="0.01">
                </div>
                <div class="player-control-title">
                    {{ escape(show['title']) }}: {% module episode_header(episode) %}
                </div>
                <div class="player-control-button player-control-button-right player-fullscreen-windowed-button player-fullscreen-button">
                    <i class="glyphicon glyphicon-fullscreen"></i>
                </div>
                <div class="player-control-button player-control-button-right player-fullscreen-windowed-button player-windowed-button hidden">
                    <i class="glyphicon glyphicon-resize-small"></i>
                </div>
            </div>
        </div>
    </div>
    <script>
        var show_id = {{ show['id'] }};
        var number = {{ episode['number'] }};
        var play_servers = [            
            {% for ps in play_servers %}
            {
                'play_id': '{{ escape(ps['play_id']) }}',
                'url': '{{ escape(ps['play_server']['url']) }}',
            }, 
            {% end %}
        ];
        var start_pos = {{ (episode.get('user_watched', {}) or {}).get('position', 0) or 0 }};
        $(function(){
            $('video').seplis_play(
                play_servers,
                show_id,
                number,
                start_pos
            );
            var controls_timer;

        });
    </script>
{% end %}