{% extends ../base.html %}
{% block head %}
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
{% end %}
{% block menu %}{% end %}
{% block body_outside %}
    <style>
    body {
        background-color:#000;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;  
    }
    </style>
    <div class="player-video-wrapper">
        <div class="video" style="position: relative; width: 100%; height: 100%; overflow: hidden;">
            <video id="video" style="position: absolute; width: 100%; height: 100%;" preload="none" autostart="true">
            </video>
        </div>
        <div class="player-loading">
            <div class="sk-spinner sk-spinner-wave">
                <div class="sk-rect1"></div>
                <div class="sk-rect2"></div>
                <div class="sk-rect3"></div>
                <div class="sk-rect4"></div>
                <div class="sk-rect5"></div>
            </div>
        </div>
        <div class="player-error player-try-refresh">
            <font style="font-size:100px;color:#a94442;">&#x26a0;</font><br>
            An error occurred. <br>
            Try to "Refresh" or "Reload" this page.
        </div>
        <div class="player-error player-play-server-error">
            <font style="font-size:100px;color:#a94442;">&#x26a0;</font><br>
            None of your play servers are available.
        </div>
        <div class="player-error player-episode-404">
            <font style="font-size:100px;color:#1E90FF;">&#x26a0;</font><br>
            This episode does not exist on any of your play servers.
        </div>        
        <div class="player-error player-casting-to">
            <img src="/static/img/cast_24dp.png"><br>
            Casting to <span class="casting-to-name"></span>.
        </div>
        <div class="player-back">
            <i class="glyphicon glyphicon-circle-arrow-left" title="Go back"></i>
        </div>
        <div class="player-controls-wrapper">
            <div class="player-slider-controls">
                <div class="player-slider">
                    <div class="player-progress">
                        <div class="player-slider-dot" dragable="true"></div>
                    </div>             
                </div>
                <label class="player-timeleft"></label>
                <div class="player-slider-time"></div> 
            </div> 
            
            <div class="player-controls">
                <div class="player-control-button player-play-pause-button player-play-button">
                    <i class="glyphicon glyphicon-play"></i>
                </div>
                <div class="player-control-button player-play-pause-button player-pause-button hidden">
                    <i class="glyphicon glyphicon-pause"></i>
                </div>
                <div class="player-control-button player-volume">
                    <i class="glyphicon glyphicon-volume-up"></i>
                    <input class="player-volume-slider" type="range" min="0" max="1" step="0.01">
                </div>
                <div class="player-control-title">
                    {{ escape(show['title']) }}: {% module episode_header(episode) %}
                </div>
                <div 
                    class="player-control-button player-control-button-right player-cast"
                >
                    <img src="/static/img/cast_24dp.png" width="32px" height="32px">
                </div>
                {% if next_episode %}
                    <div 
                        class="player-control-button player-control-button-right player-play-next"
                        title="Play next episode"
                    >
                        <a 
                            href="/show/{{ show['id'] }}/episode/{{ next_episode['number'] }}/play"
                        >
                            <i class="glyphicon glyphicon-step-forward"></i>
                        </a>
                    </div>
                {% end %}
                <div class="player-control-button player-control-button-right player-fullscreen-windowed-button player-fullscreen-button">
                    <i class="glyphicon glyphicon-fullscreen"></i>
                </div>
                <div class="player-control-button player-control-button-right player-fullscreen-windowed-button player-windowed-button hidden">
                    <i class="glyphicon glyphicon-resize-small"></i>
                </div>
            </div>
        </div>
    </div>
    <script>
        var show_id = {{ show['id'] }};
        var number = {{ episode['number'] }};
        var play_servers = [            
            {% for ps in play_servers %}
            {
                'play_id': '{{ escape(ps['play_id']) }}',
                'url': '{{ escape(ps['play_server']['url']) }}',
            }, 
            {% end %}
        ];
        var start_pos = {{ (episode.get('user_watched', {}) or {}).get('position', 0) or 0 }};
        $(function(){
            $('video').seplis_play(
                play_servers,
                show_id,
                number,
                start_pos,
                "{{ chromecast_appid }}"
            );
            var controls_timer;
        });
    </script>
{% end %}