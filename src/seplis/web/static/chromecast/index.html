<html>
    <head>
        <title>SEPLIS CAST</title>
            <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>

            <style>
                body {
                    background-color: #000; 
                    font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
                }

                #media {
                    
                }

                #logocenter {
                    position: relative;
                    top: 50%;
                    transform: translateY(-50%);
                }

                #logocenter .text {
                    text-align: center;
                    font-size: 200px;
                    color: #428bca;
                }

                video {
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    left: 0;
                    top: 0;
                    opacity: 1;
                    z-index: 1;
                    visibility: visible;
                }
            </style>
    </head>
    <body>
        <video id="media"></video>
        <div id="logocenter">
            <div class="text">
                SEPLIS
            </div>
        </div>
        <script>
            var currentInfo = null;
            var token = null;

            var mediaElement = document.getElementById('media');
            var mediaManager = new cast.receiver.MediaManager(mediaElement);

            mediaManager['onLoadOrig'] = mediaManager.onLoad;
            mediaManager.onLoad = function(event) {
                mediaManager['onLoadOrig'](event);
                var senders = castReceiverManager.getSenders();
                for (var i in senders) {
                    console.log(senders[i]);
                    messageInfo.send(senders[i], currentInfo);
                }
                console.log(castReceiverManager.getSenders());
            }

            mediaManager['onEndedOrig'] = mediaManager.onEnded;
            mediaManager.onEnded = function() {
                currentInfo = null;
                token = null;
                console.log('onEnded');
                mediaManager['onEndedOrig']();
            }

            var castReceiverManager = cast.receiver.CastReceiverManager.getInstance();         

            var messageInfo = castReceiverManager.getCastMessageBus(
                'urn:x-cast:net.seplis.cast.info',
                cast.receiver.CastMessageBus.MessageType.JSON
            );
            messageInfo.onMessage = function(event) {
                currentInfo = event.data;
                token = currentInfo.token;
                delete currentInfo['token'];
            }

            var messageSendInfo = castReceiverManager.getCastMessageBus(
                'urn:x-cast:net.seplis.cast.sendinfo',
                cast.receiver.CastMessageBus.MessageType.JSON
            );
            messageSendInfo.onMessage = function(event) {
                if (!currentInfo)
                    return;
                messageInfo.send(event.senderId, currentInfo);
            }

            castReceiverManager.onSenderConnected = function(event) {
                messageInfo.send(event.senderId, currentInfo);
            }

            castReceiverManager.start();
        </script>
    </body>
</html>